<!DOCTYPE html><html class="default" lang="en" data-base="../"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@conterra/reactivity-events - v0.8.0 | Reactive APIs</title><meta name="description" content="Documentation for Reactive APIs"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="../index.html" class="title">Reactive APIs</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb" aria-label="Breadcrumb"><li><a href="" aria-current="page">@conterra/reactivity-events</a></li></ul><h1>Module @conterra/reactivity-events - v0.8.0</h1></div><section class="tsd-panel tsd-typography"><h1 id="conterrareactivity-events-npm-version" class="tsd-anchor-link">@conterra/reactivity-events <a href="https://www.npmjs.com/package/@conterra/reactivity-events"><img src="https://img.shields.io/npm/v/%40conterra%2Freactivity-events" alt="NPM Version"></a><a href="#conterrareactivity-events-npm-version" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>Event support for reactive objects. Based on <code>@conterra/reactivity-core</code>.</p>
<p>Click here to visit the <a href="https://conterra.github.io/reactivity/latest/">rendered API Documentation</a>.</p>
<h2 id="quick-example" class="tsd-anchor-link">Quick Example<a href="#quick-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">emit</span><span class="hl-1">, </span><span class="hl-2">emitter</span><span class="hl-1">, </span><span class="hl-2">on</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@conterra/reactivity-events&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">interface</span><span class="hl-1"> </span><span class="hl-10">ClickEvent</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">x</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-2">y</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-4">class</span><span class="hl-1"> </span><span class="hl-10">View</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">readonly</span><span class="hl-1"> </span><span class="hl-2">clicked</span><span class="hl-1"> = </span><span class="hl-6">emitter</span><span class="hl-1">&lt;</span><span class="hl-10">ClickEvent</span><span class="hl-1">&gt;();</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">view</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">View</span><span class="hl-1">();</span><br/><br/><span class="hl-8">// Subscribe to the click event</span><br/><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">view</span><span class="hl-1">.</span><span class="hl-2">clicked</span><span class="hl-1">, (</span><span class="hl-2">event</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">`Click at </span><span class="hl-4">${</span><span class="hl-2">event</span><span class="hl-7">.</span><span class="hl-2">x</span><span class="hl-4">}</span><span class="hl-3">, </span><span class="hl-4">${</span><span class="hl-2">event</span><span class="hl-7">.</span><span class="hl-2">y</span><span class="hl-4">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-8">// Emit the click event, calling all subscribers</span><br/><span class="hl-6">emit</span><span class="hl-1">(</span><span class="hl-2">view</span><span class="hl-1">.</span><span class="hl-2">clicked</span><span class="hl-1">, { </span><span class="hl-2">x:</span><span class="hl-1"> </span><span class="hl-9">10</span><span class="hl-1">, </span><span class="hl-2">y:</span><span class="hl-1"> </span><span class="hl-9">20</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

<h2 id="usage" class="tsd-anchor-link">Usage<a href="#usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Use <code>emitter()</code> to create an event emitter.
Event emitters can be used to emit events (using <code>emit()</code>) and to subscribe to them (using <code>on()</code>).</p>
<p>Example:</p>
<pre><code class="ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">emitter</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@conterra/reactivity-events&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-8">// Emits numbers</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">e1</span><span class="hl-1"> = </span><span class="hl-6">emitter</span><span class="hl-1">&lt;</span><span class="hl-10">number</span><span class="hl-1">&gt;();</span><br/><br/><span class="hl-8">// Emits objects with x and y properties</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">e2</span><span class="hl-1"> = </span><span class="hl-6">emitter</span><span class="hl-1">&lt;{ </span><span class="hl-2">x</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">; </span><span class="hl-2">y</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1"> }&gt;();</span><br/><br/><span class="hl-8">// Emits nothing (void)</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">e3</span><span class="hl-1"> = </span><span class="hl-6">emitter</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<p>Use <code>emit(emitter, event)</code> to emit an event.
For example:</p>
<pre><code class="ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">emit</span><span class="hl-1">, </span><span class="hl-2">emitter</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@conterra/reactivity-events&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-8">// Emits objects with x and y properties</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">clicked</span><span class="hl-1"> = </span><span class="hl-6">emitter</span><span class="hl-1">&lt;{ </span><span class="hl-2">x</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">; </span><span class="hl-2">y</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1"> }&gt;();</span><br/><br/><span class="hl-8">// Broadcasts the event to all subscribers of `clicked`</span><br/><span class="hl-6">emit</span><span class="hl-1">(</span><span class="hl-2">clicked</span><span class="hl-1">, { </span><span class="hl-2">x:</span><span class="hl-1"> </span><span class="hl-9">10</span><span class="hl-1">, </span><span class="hl-2">y:</span><span class="hl-1"> </span><span class="hl-9">20</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

<p>Use <code>on(emitter, callback)</code> to subscribe to events:</p>
<pre><code class="ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">emitter</span><span class="hl-1">, </span><span class="hl-2">on</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@conterra/reactivity-events&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">clicked</span><span class="hl-1"> = </span><span class="hl-6">emitter</span><span class="hl-1">&lt;{ </span><span class="hl-2">x</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">; </span><span class="hl-2">y</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1"> }&gt;();</span><br/><br/><span class="hl-8">// Callback will be invoked whenever the event is emitted</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">handle</span><span class="hl-1"> = </span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">clicked</span><span class="hl-1">, (</span><span class="hl-2">event</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&quot;Clicked at&quot;</span><span class="hl-1">, </span><span class="hl-2">event</span><span class="hl-1">.</span><span class="hl-2">x</span><span class="hl-1">, </span><span class="hl-2">event</span><span class="hl-1">.</span><span class="hl-2">y</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-8">// Use the handle to unsubscribe from the event when no longer needed</span><br/><span class="hl-2">handle</span><span class="hl-1">.</span><span class="hl-6">destroy</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<h3 id="sync-vs-async-event-callbacks" class="tsd-anchor-link">Sync vs async event callbacks<a href="#sync-vs-async-event-callbacks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The events API supports a similar <code>dispatch</code> option as <code>@conterra/reactivity-core</code> when subscribing via <code>on()</code>:</p>
<ul>
<li><code>&quot;async&quot;</code> (the default): Callbacks are called asynchronously (in a future task, similar to <code>setTimeout(cb, 0)</code>).
This is usually what you want.</li>
<li><code>&quot;sync&quot;</code>: Callbacks are called synchronously, immediately after they have been emitted.
Note that there is a subtle interaction with <code>batch</code> (see <a href="#integration-with-batch">Integration with <code>batch</code></a>).</li>
</ul>
<h3 id="reactive-event-sources" class="tsd-anchor-link">Reactive event sources<a href="#reactive-event-sources" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>on()</code> support multiple kinds of event source parameters:</p>
<ul>
<li>A plain event source (like <code>view.clicked</code> in the example above; not reactive).</li>
<li>A signal holding an event source (reactive).</li>
<li>A function returning an event source, implemented using signals (reactive).</li>
</ul>
<p>In the following examples, the signal <code>currentLogger</code> points to the active logger object (either <code>logger1</code> or <code>logger2</code>).
The subscription configured by <code>on</code> automatically switches between the two loggers whenever the signal changes.
In other words, it always stays subscribed to the current one.</p>
<pre><code class="ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">nextTick</span><span class="hl-1">, </span><span class="hl-2">reactive</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@conterra/reactivity-core&quot;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">emit</span><span class="hl-1">, </span><span class="hl-2">emitter</span><span class="hl-1">, </span><span class="hl-2">on</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@conterra/reactivity-events&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">class</span><span class="hl-1"> </span><span class="hl-10">Logger</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">onMessage</span><span class="hl-1"> = </span><span class="hl-6">emitter</span><span class="hl-1">&lt;</span><span class="hl-10">string</span><span class="hl-1">&gt;();</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">logger1</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Logger</span><span class="hl-1">();</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">logger2</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Logger</span><span class="hl-1">();</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">currentLogger</span><span class="hl-1"> = </span><span class="hl-6">reactive</span><span class="hl-1">(</span><span class="hl-2">logger1</span><span class="hl-1">);</span><br/><br/><span class="hl-8">// Stays subscribed to the current logger, even if it changes.</span><br/><span class="hl-6">on</span><span class="hl-1">(</span><br/><span class="hl-1">    () </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">currentLogger</span><span class="hl-1">.</span><span class="hl-2">value</span><span class="hl-1">.</span><span class="hl-2">onMessage</span><span class="hl-1">,</span><br/><span class="hl-1">    (</span><span class="hl-2">message</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&quot;on message:&quot;</span><span class="hl-1">, </span><span class="hl-2">message</span><span class="hl-1">)</span><br/><span class="hl-1">);</span><br/><span class="hl-6">emit</span><span class="hl-1">(</span><span class="hl-2">logger1</span><span class="hl-1">.</span><span class="hl-2">onMessage</span><span class="hl-1">, </span><span class="hl-3">&quot;Message to logger 1&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-8">// Wait for event listener to be called (just for illustration).</span><br/><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">nextTick</span><span class="hl-1">();</span><br/><br/><span class="hl-8">// Signal changes, `on` automatically unsubscribes from logger1 and subscribes to logger2.</span><br/><span class="hl-2">currentLogger</span><span class="hl-1">.</span><span class="hl-2">value</span><span class="hl-1"> = </span><span class="hl-2">logger2</span><span class="hl-1">;</span><br/><span class="hl-6">emit</span><span class="hl-1">(</span><span class="hl-2">logger2</span><span class="hl-1">.</span><span class="hl-2">onMessage</span><span class="hl-1">, </span><span class="hl-3">&quot;Message to logger 2&quot;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<h3 id="one-off-event-listeners" class="tsd-anchor-link">One-off event listeners<a href="#one-off-event-listeners" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Configuring <code>once: true</code> within a subscription will automatically unsubscribe after the first event has been emitted:</p>
<pre><code class="ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">emit</span><span class="hl-1">, </span><span class="hl-2">emitter</span><span class="hl-1">, </span><span class="hl-2">on</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@conterra/reactivity-events&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">clicked</span><span class="hl-1"> = </span><span class="hl-6">emitter</span><span class="hl-1">();</span><br/><br/><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">clicked</span><span class="hl-1">, () </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&quot;clicked&quot;</span><span class="hl-1">), { </span><span class="hl-2">once:</span><span class="hl-1"> </span><span class="hl-4">true</span><span class="hl-1"> });</span><br/><span class="hl-6">emit</span><span class="hl-1">(</span><span class="hl-2">clicked</span><span class="hl-1">);</span><br/><span class="hl-6">emit</span><span class="hl-1">(</span><span class="hl-2">clicked</span><span class="hl-1">);</span><br/><span class="hl-8">// Output: clicked (only once)</span>
</code><button type="button">Copy</button></pre>

<p>Note that is still a good idea to call <code>destroy</code> on the handle returned by <code>on</code> if you want to unsubscribe manually before the first event has been emitted.</p>
<h3 id="detecting-subscribers" class="tsd-anchor-link">Detecting subscribers<a href="#detecting-subscribers" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>When providing an event, you can use the <code>subscribed</code> and <code>unsubscribed</code> options to detect when your event is actually being used:</p>
<ul>
<li><code>subscribed()</code> will be called when the <em>first</em> subscriber subscribes to the event.
This can be used to initialize the event source lazily.</li>
<li><code>unsubscribed()</code> will be called when the <em>last</em> subscriber unsubscribes from the event.
This can be used to clean up resources initialized in <code>subscribed()</code>.</li>
</ul>
<p>Example:</p>
<pre><code class="ts"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">mouseMoved</span><span class="hl-1"> = </span><span class="hl-6">emitter</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-6">subscribed</span><span class="hl-2">:</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-8">// Start listening for mouse events</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-6">unsubscribed</span><span class="hl-2">:</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-8">// Stop listening for mouse events</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<h3 id="typescript-support" class="tsd-anchor-link">TypeScript support<a href="#typescript-support" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>This package provides two important TypeScript types:</p>
<ul>
<li><code>EventEmitter&lt;T&gt;</code>.
The return type of <code>emitter&lt;T&gt;</code>.
This type supports both emitting and subscribing to events.</li>
<li><code>EventSource&lt;T&gt;</code>.
This type allows only subscribing to events.
This is useful for public interfaces where users are not supposed to emit events themselves.</li>
</ul>
<p>Note that the restrictions imposed by <code>EventSource&lt;T&gt;</code> are a compile time feature only:
at runtime, both interfaces are represented by the same object.</p>
<p>The following example demonstrates the use of <code>EventSource</code> to separate the public interface from the implementation:</p>
<pre><code class="ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">emit</span><span class="hl-1">, </span><span class="hl-2">emitter</span><span class="hl-1">, </span><span class="hl-2">on</span><span class="hl-1">, </span><span class="hl-2">EventSource</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@conterra/reactivity-events&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">interface</span><span class="hl-1"> </span><span class="hl-10">ClickEvent</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">x</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-2">y</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-8">// Public interface</span><br/><span class="hl-4">interface</span><span class="hl-1"> </span><span class="hl-10">ViewApi</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">readonly</span><span class="hl-1"> </span><span class="hl-2">clicked</span><span class="hl-1">: </span><span class="hl-10">EventSource</span><span class="hl-1">&lt;</span><span class="hl-10">ClickEvent</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-8">// Private implementation</span><br/><span class="hl-4">class</span><span class="hl-1"> </span><span class="hl-10">ViewImpl</span><span class="hl-1"> </span><span class="hl-4">implements</span><span class="hl-1"> </span><span class="hl-10">ViewApi</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">clicked</span><span class="hl-1"> = </span><span class="hl-6">emitter</span><span class="hl-1">&lt;</span><span class="hl-10">ClickEvent</span><span class="hl-1">&gt;();</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">viewImpl</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">ViewImpl</span><span class="hl-1">();</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">viewApi</span><span class="hl-1">: </span><span class="hl-10">ViewApi</span><span class="hl-1"> = </span><span class="hl-2">viewImpl</span><span class="hl-1">;</span><br/><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">viewApi</span><span class="hl-1">.</span><span class="hl-2">clicked</span><span class="hl-1">, (</span><span class="hl-2">event</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&quot;Clicked at&quot;</span><span class="hl-1">, </span><span class="hl-2">event</span><span class="hl-1">.</span><span class="hl-2">x</span><span class="hl-1">, </span><span class="hl-2">event</span><span class="hl-1">.</span><span class="hl-2">y</span><span class="hl-1">));</span><br/><br/><span class="hl-6">emit</span><span class="hl-1">(</span><span class="hl-2">viewImpl</span><span class="hl-1">.</span><span class="hl-2">clicked</span><span class="hl-1">, { </span><span class="hl-2">x:</span><span class="hl-1"> </span><span class="hl-9">1</span><span class="hl-1">, </span><span class="hl-2">y:</span><span class="hl-1"> </span><span class="hl-9">2</span><span class="hl-1"> });</span><br/><br/><span class="hl-8">// would be a TypeScript error:</span><br/><span class="hl-8">// emit(viewApi.clicked, { x: 3, y: 4 });</span>
</code><button type="button">Copy</button></pre>

<h3 id="integration-with-batch" class="tsd-anchor-link">Integration with <code>batch</code><a href="#integration-with-batch" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>batch()</code> function from <code>@conterra/reactivity-core</code> can be used to group reactive changes to one or more signals, comparable to a transaction.
Effects or watches are not executed until the batch completes.
This prevents intermediate states (which may be inconsistent) from being observed by other parts of the application.</p>
<p>Event handling works the same way: even when <code>on()</code> is used with <code>dispatch: &quot;sync&quot;</code>, event handlers are not running <em>immediately</em>, but only after the batch completes.
This prevents event handlers from observing intermediate states as well.</p>
<p>For example:</p>
<pre><code class="ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">batch</span><span class="hl-1">, </span><span class="hl-2">reactive</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@conterra/reactivity-core&quot;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">emit</span><span class="hl-1">, </span><span class="hl-2">emitter</span><span class="hl-1">, </span><span class="hl-2">on</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@conterra/reactivity-events&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">class</span><span class="hl-1"> </span><span class="hl-10">Foo</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">changed</span><span class="hl-1"> = </span><span class="hl-6">emitter</span><span class="hl-1">();</span><br/><br/><span class="hl-1">    </span><span class="hl-2">a</span><span class="hl-1"> = </span><span class="hl-6">reactive</span><span class="hl-1">(</span><span class="hl-9">0</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-2">b</span><span class="hl-1"> = </span><span class="hl-6">reactive</span><span class="hl-1">(</span><span class="hl-9">1</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-6">changeValues</span><span class="hl-1">() {</span><br/><span class="hl-1">        </span><span class="hl-6">batch</span><span class="hl-1">(() </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">debug</span><span class="hl-1">(</span><span class="hl-3">&quot;batch start&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-1">            </span><span class="hl-8">// Values are changed together.</span><br/><span class="hl-1">            </span><span class="hl-4">this</span><span class="hl-1">.</span><span class="hl-2">a</span><span class="hl-1">.</span><span class="hl-2">value</span><span class="hl-1"> += </span><span class="hl-9">1</span><span class="hl-1">;</span><br/><span class="hl-1">            </span><span class="hl-6">emit</span><span class="hl-1">(</span><span class="hl-4">this</span><span class="hl-1">.</span><span class="hl-2">changed</span><span class="hl-1">); </span><span class="hl-8">// Callbacks are _not_ running here</span><br/><span class="hl-1">            </span><span class="hl-4">this</span><span class="hl-1">.</span><span class="hl-2">b</span><span class="hl-1">.</span><span class="hl-2">value</span><span class="hl-1"> += </span><span class="hl-9">1</span><span class="hl-1">;</span><br/><br/><span class="hl-1">            </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">debug</span><span class="hl-1">(</span><span class="hl-3">&quot;batch end&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        }); </span><span class="hl-8">// Callbacks are running here</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">foo</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Foo</span><span class="hl-1">();</span><br/><span class="hl-6">on</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-2">foo</span><span class="hl-1">.</span><span class="hl-2">changed</span><span class="hl-1">,</span><br/><span class="hl-1">    () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&quot;on change&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    { </span><span class="hl-2">dispatch:</span><span class="hl-1"> </span><span class="hl-3">&quot;sync&quot;</span><span class="hl-1"> }</span><br/><span class="hl-1">);</span><br/><span class="hl-2">foo</span><span class="hl-1">.</span><span class="hl-6">changeValues</span><span class="hl-1">();</span><br/><span class="hl-8">// Output:</span><br/><span class="hl-8">// batch start</span><br/><span class="hl-8">// batch end</span><br/><span class="hl-8">// on change</span>
</code><button type="button">Copy</button></pre>

<p>Try removing the <code>batch</code> call to see the difference.</p>
</section><details class="tsd-panel-group tsd-member-group tsd-accordion" open><summary class="tsd-accordion-summary" data-key="section-Events"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h2>Events</h2></summary><dl class="tsd-member-summaries"><dt class="tsd-member-summary" id="emitteroptions"><span class="tsd-member-summary-name"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Interface"><use href="../assets/icons.svg#icon-256"></use></svg><a href="../interfaces/_conterra_reactivity-events.EmitterOptions.html">EmitterOptions</a><a href="#emitteroptions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></span></dt><dd class="tsd-member-summary"></dd><dt class="tsd-member-summary" id="eventemitter"><span class="tsd-member-summary-name"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Interface"><use href="../assets/icons.svg#icon-256"></use></svg><a href="../interfaces/_conterra_reactivity-events.EventEmitter.html">EventEmitter</a><a href="#eventemitter" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></span></dt><dd class="tsd-member-summary"></dd><dt class="tsd-member-summary" id="eventsource"><span class="tsd-member-summary-name"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Interface"><use href="../assets/icons.svg#icon-256"></use></svg><a href="../interfaces/_conterra_reactivity-events.EventSource.html">EventSource</a><a href="#eventsource" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></span></dt><dd class="tsd-member-summary"></dd><dt class="tsd-member-summary" id="emit"><span class="tsd-member-summary-name"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Function"><use href="../assets/icons.svg#icon-64"></use></svg><a href="../functions/_conterra_reactivity-events.emit.html">emit</a><a href="#emit" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></span></dt><dd class="tsd-member-summary"></dd><dt class="tsd-member-summary" id="emitter"><span class="tsd-member-summary-name"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Function"><use href="../assets/icons.svg#icon-64"></use></svg><a href="../functions/_conterra_reactivity-events.emitter.html">emitter</a><a href="#emitter" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></span></dt><dd class="tsd-member-summary"></dd></dl></details><details class="tsd-panel-group tsd-member-group tsd-accordion" open><summary class="tsd-accordion-summary" data-key="section-Subscribing"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h2>Subscribing</h2></summary><dl class="tsd-member-summaries"><dt class="tsd-member-summary" id="subscribeoptions"><span class="tsd-member-summary-name"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Interface"><use href="../assets/icons.svg#icon-256"></use></svg><a href="../interfaces/_conterra_reactivity-events.SubscribeOptions.html">SubscribeOptions</a><a href="#subscribeoptions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></span></dt><dd class="tsd-member-summary"></dd><dt class="tsd-member-summary" id="dispatchtype"><span class="tsd-member-summary-name"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Type Alias"><use href="../assets/icons.svg#icon-2097152"></use></svg><a href="../types/_conterra_reactivity-events.DispatchType.html">DispatchType</a><a href="#dispatchtype" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></span></dt><dd class="tsd-member-summary"></dd><dt class="tsd-member-summary" id="on"><span class="tsd-member-summary-name"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Function"><use href="../assets/icons.svg#icon-64"></use></svg><a href="../functions/_conterra_reactivity-events.on.html">on</a><a href="#on" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></span></dt><dd class="tsd-member-summary"></dd><dt class="tsd-member-summary" id="onsync"><span class="tsd-member-summary-name"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Function"><use href="../assets/icons.svg#icon-64"></use></svg><a class="deprecated" href="../functions/_conterra_reactivity-events.onSync.html">onSync</a><a href="#onsync" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></span></dt><dd class="tsd-member-summary"></dd></dl></details><details class="tsd-panel-group tsd-member-group tsd-accordion" open><summary class="tsd-accordion-summary" data-key="section-Helpers"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h2>Helpers</h2></summary><dl class="tsd-member-summaries"><dt class="tsd-member-summary" id="eventargs"><span class="tsd-member-summary-name"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Type Alias"><use href="../assets/icons.svg#icon-2097152"></use></svg><a href="../types/_conterra_reactivity-events.EventArgs.html">EventArgs</a><a href="#eventargs" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></span></dt><dd class="tsd-member-summary"></dd><dt class="tsd-member-summary" id="eventcallback"><span class="tsd-member-summary-name"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Type Alias"><use href="../assets/icons.svg#icon-2097152"></use></svg><a href="../types/_conterra_reactivity-events.EventCallback.html">EventCallback</a><a href="#eventcallback" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></span></dt><dd class="tsd-member-summary"></dd></dl></details></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#conterrareactivity-events-npm-version"><span>@conterra/reactivity-<wbr/>events <wbr/>NPM <wbr/>Version</span></a><ul><li><a href="#quick-example"><span>Quick <wbr/>Example</span></a></li><li><a href="#usage"><span>Usage</span></a></li><li><ul><li><a href="#sync-vs-async-event-callbacks"><span>Sync vs async event callbacks</span></a></li><li><a href="#reactive-event-sources"><span>Reactive event sources</span></a></li><li><a href="#one-off-event-listeners"><span>One-<wbr/>off event listeners</span></a></li><li><a href="#detecting-subscribers"><span>Detecting subscribers</span></a></li><li><a href="#typescript-support"><span>Type<wbr/>Script support</span></a></li><li><a href="#integration-with-batch"><span>Integration with batch</span></a></li></ul></li></ul><details open class="tsd-accordion tsd-page-navigation-section"><summary class="tsd-accordion-summary" data-key="section-Events"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Events</summary><div><a href="#emitteroptions"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Interface"><use href="../assets/icons.svg#icon-256"></use></svg><span>Emitter<wbr/>Options</span></a><a href="#eventemitter"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Interface"><use href="../assets/icons.svg#icon-256"></use></svg><span>Event<wbr/>Emitter</span></a><a href="#eventsource"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Interface"><use href="../assets/icons.svg#icon-256"></use></svg><span>Event<wbr/>Source</span></a><a href="#emit"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Function"><use href="../assets/icons.svg#icon-64"></use></svg><span>emit</span></a><a href="#emitter"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Function"><use href="../assets/icons.svg#icon-64"></use></svg><span>emitter</span></a></div></details><details open class="tsd-accordion tsd-page-navigation-section"><summary class="tsd-accordion-summary" data-key="section-Subscribing"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Subscribing</summary><div><a href="#subscribeoptions"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Interface"><use href="../assets/icons.svg#icon-256"></use></svg><span>Subscribe<wbr/>Options</span></a><a href="#dispatchtype"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Type Alias"><use href="../assets/icons.svg#icon-2097152"></use></svg><span>Dispatch<wbr/>Type</span></a><a href="#on"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Function"><use href="../assets/icons.svg#icon-64"></use></svg><span>on</span></a><a href="#onsync"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Function"><use href="../assets/icons.svg#icon-64"></use></svg><span>on<wbr/>Sync</span></a></div></details><details open class="tsd-accordion tsd-page-navigation-section"><summary class="tsd-accordion-summary" data-key="section-Helpers"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Helpers</summary><div><a href="#eventargs"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Type Alias"><use href="../assets/icons.svg#icon-2097152"></use></svg><span>Event<wbr/>Args</span></a><a href="#eventcallback"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Type Alias"><use href="../assets/icons.svg#icon-2097152"></use></svg><span>Event<wbr/>Callback</span></a></div></details></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../index.html">Reactive APIs</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
